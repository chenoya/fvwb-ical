<!doctype html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Calendrier clubee FVWB vers iCal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body class="container">

<div class="row g-3 my-2 mx-1">
    <img src="logo.png" class="col-4"/>
</div>

<div class="row g-3 my-2 mx-1">

    <div class="col-md-12">
        <h1 class="fs-2">Ajoutez les matchs de votre équipe directement dans votre calendrier.</h1>
        Les informations sur les horaires, équipes, adresses et salles sont collectées sur le <a
            href="https://www.portailfvwb.be/">nouveau portail clubee du FVWB</a> et mises à disposition sous forme
        d'une souscription iCalendar automatiquement mise à jour.
    </div>

</div>

<div class="row g-3 my-2 mx-1">

    <div class="col-md-6">
        <label for="year" class="form-label">Saison</label>
        <select id="year" onchange="changeYear(this.value)" class="form-control"></select>
    </div>

    <div class="col-md-6">
        <label for="prov" class="form-label">Province / Région</label>
        <select id="prov" onchange="changeProv(this.value)" class="form-control"></select>
    </div>

    <div class="col-md-6">
        <label for="level" class="form-label">Niveau / Série</label>
        <select id="level" onchange="changeLevel(this.value)" class="form-control"></select>
    </div>

    <div class="col-md-6">
        <label for="team" class="form-label">Equipe</label>
        <select id="team" onchange="changeTeam(this.value)" class="form-control"></select>
    </div>

</div>

<div class="row g-3 my-2 mx-1">
    <a id="subscribe" class="btn btn-primary">Souscrire au calendrier</a>
</div>

<div class="row g-3 my-4 mx-1 text-center">
    <a href="https://github.com/chenoya/fvwb-ical" class="link-secondary col-md-2">
        Code source <img src="github-mark.png" style="display: inline; height: 1em">
    </a>

    <a href="https://docs.github.com/fr/site-policy/privacy-policies/github-general-privacy-statement"
       class="link-secondary col-md-3">Politique de Confidentialité</a>

    <p class="text-secondary col-md-6">
        Site web non affilié au FVWB ni à Clubee. Les données fournies peuvent être inexactes.
        Veuillez-vous référer aux
        <a href="https://www.portailfvwb.be/" class="link-secondary">informations officielles du FVWB</a>
        en cas de doute.
    </p>
</div>

<script type="text/javascript">
    let mapping;

    fetch("ics/mapping.json")
        .then(response => response.json())
        .then(mappingRes => {
            mapping = mappingRes;
            changeMapping();
        });

    function changeMapping() {
        let selection = document.getElementById("year");
        selection.innerHTML = "";

        let years = Object.keys(mapping).sort();
        years.forEach(year => selection.options.add(newOption(year)));
        selection.value = years[0];

        changeYear(years[0]);
    }

    function changeYear(year) {
        let selection = document.getElementById("prov");
        selection.innerHTML = "";

        let provs = Object.keys(mapping[year]).sort();
        provs.forEach(prov => selection.options.add(newOption(prov)));
        selection.value = provs[0];

        changeProv(provs[0]);
    }

    function changeProv(prov) {
        let selection = document.getElementById("level");
        selection.innerHTML = "";

        let year = document.getElementById("year").value;
        let levels = Object.keys(mapping[year][prov]).sort();;
        levels.forEach(level => selection.options.add(newOption(level)));
        selection.value = levels[0];

        changeLevel(levels[0]);
    }

    function changeLevel(level) {
        let selection = document.getElementById("team");
        selection.innerHTML = "";

        let year = document.getElementById("year").value;
        let prov = document.getElementById("prov").value;
        let teams = Object.keys(mapping[year][prov][level]).sort();
        teams.forEach(team => selection.options.add(newOption(team)));
        selection.value = teams[0];
        changeTeam(teams[0]);
    }

    function changeTeam(team) {
        let year = document.getElementById("year").value;
        let prov = document.getElementById("prov").value;
        let level = document.getElementById("level").value;

        let link = "webcal://github.com/chenoya/fvwb-ical/raw/refs/heads/main/docs" + mapping[year][prov][level][team];
        document.getElementById("subscribe").href = link;
    }

    function newOption(value) {
        let option = document.createElement("option");
        option.value = value;
        option.innerText = value;
        return option;
    }
</script>
</body>

</html>